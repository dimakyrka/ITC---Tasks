<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <style>
        :root {
            --primary: #3f51b5;
            --text: #333;
            --border: #e0e0e0;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
        }
        .input-container {
            display: flex;
            margin-bottom: 20px;
            position: relative;
        }
        input {
            flex: 1;
            padding: 16px 50px 16px 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
        }
        .add-btn {
            position: absolute;
            right: 8px;
            top: 8px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
        }
        .task-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>Task Manager</h1>
    
    <div class="input-container">
        <input type="text" id="taskInput" placeholder="Новая задача...">
        <button class="add-btn" id="addTaskBtn">+</button>
    </div>
    
    <div id="taskList"></div>

    <script>
        // Инициализация WebApp
        Telegram.WebApp.expand();
        Telegram.WebApp.enableClosingConfirmation();
        
        // Элементы интерфейса
        const taskInput = document.getElementById('taskInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskList = document.getElementById('taskList');
        
        // Загрузка задач при открытии
        loadTasks();
        
        // Обработчики событий
        addTaskBtn.addEventListener('click', addTask);
        taskInput.addEventListener('keypress', (e) => e.key === 'Enter' && addTask());
        
        // Функции работы с задачами
        async function loadTasks() {
            const response = await sendToBot({ action: 'get_tasks' });
            renderTasks(response || []);
        }
        
        async function addTask() {
            const text = taskInput.value.trim();
            if (text) {
                await sendToBot({ 
                    action: 'add_task', 
                    text: text 
                });
                taskInput.value = '';
                loadTasks();
            }
        }
        
        async function deleteTask(id) {
            await sendToBot({ 
                action: 'delete_task', 
                id: id 
            });
            loadTasks();
        }
        
        // Отправка данных в бота
        function sendToBot(data) {
            return new Promise((resolve) => {
                Telegram.WebApp.sendData(JSON.stringify(data));
                Telegram.WebApp.onEvent('mainButtonClicked', () => {
                    const receivedData = Telegram.WebApp.receivedData;
                    resolve(receivedData ? JSON.parse(receivedData) : null);
                });
            });
        }
        
        // Отображение задач
        function renderTasks(tasks) {
            taskList.innerHTML = tasks.length 
                ? tasks.map(task => `
                    <div class="task-card">
                        ${task.text}
                        <button onclick="deleteTask(${task.id})">×</button>
                    </div>
                `).join('')
                : '<p>Нет задач</p>';
        }
        
        // Экспортируем функции в глобальную область видимости
        window.deleteTask = deleteTask;
    </script>
</body>
</html>
